<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6366f1">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script th:src="@{/js/app.js}" defer></script>
</head>
<body>
<div class="header">
    <h1>TeamBalancer</h1>
    <div class="user-info">
        <span>üë§ <span sec:authentication="name"></span></span>
        <a th:href="@{/admin/users}" class="btn btn-sm btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</a>
        <a th:href="@{/dashboard}" class="btn btn-sm btn-secondary">üìä –î–∞—à–±–æ—Ä–¥</a>
        <form th:action="@{/logout}" method="post" style="display:inline;">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button type="submit" class="btn btn-sm btn-secondary">üö™ –í—ã–π—Ç–∏</button>
        </form>
    </div>
</div>

<div class="navigation">
    <a th:href="@{/tasks/create}" sec:authorize="hasRole('ADMIN')" class="nav-link">
        ‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
    </a>
    <a th:href="@{/tasks}" class="nav-link">üìã –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏</a>
    <a th:href="@{/archive}" class="nav-link">üìÅ –ê—Ä—Ö–∏–≤ –∑–∞–¥–∞—á</a>
    <a th:href="@{/admin/users}" sec:authorize="hasRole('ADMIN')" class="nav-link active">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
    <a th:href="@{/dashboard}" class="nav-link">üè† –ì–ª–∞–≤–Ω–∞—è</a>
    <a th:href="@{/admin/reports}" sec:authorize="hasRole('ADMIN')" class="nav-link">üìä –û—Ç—á–µ—Ç—ã</a>
</div>

<div class="content">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
            <div class="user-meta">
                <span class="user-id">ID: <span th:text="${user?.id} ?: 'N/A'"></span></span>
            </div>
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div th:if="${param.error}" class="alert alert-error">
            ‚ùå
            <span th:if="${param.error == 'not_found'}">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω!</span>
            <span th:if="${param.error == 'load'}">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!</span>
            <span th:if="${param.error == 'update'}">–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!</span>
        </div>

        <div th:if="${param.success}" class="alert alert-success">
            ‚úÖ
            <span th:if="${param.success == 'updated'}">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!</span>
        </div>

        <form th:action="@{'/admin/users/update/' + ${user?.id}}" method="post" class="form-container">
            <div class="form-row">
                <div class="form-group">
                    <label for="username">üë§ –õ–æ–≥–∏–Ω *</label>
                    <input type="text" id="username" name="username"
                           th:value="${user?.username}" required
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                </div>

                <div class="form-group">
                    <label for="email">üìß Email *</label>
                    <input type="email" id="email" name="email"
                           th:value="${user?.email}" required
                           placeholder="–í–≤–µ–¥–∏—Ç–µ email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="fullName">üë®‚Äçüíº –ü–æ–ª–Ω–æ–µ –∏–º—è</label>
                    <input type="text" id="fullName" name="fullName"
                           th:value="${user?.fullName}"
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –∏–º—è">
                </div>

                <div class="form-group">
                    <label for="role">üé≠ –†–æ–ª—å *</label>
                    <select id="role" name="role" required>
                        <option value="USER"
                                th:selected="${user?.role == 'USER'}">üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
                        <option value="ADMIN"
                                th:selected="${user?.role == 'ADMIN'}">üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="password">üîë –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                <input type="password" id="password" name="password"
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å)">
                <small class="form-hint">–û—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –º–µ–Ω—è—Ç—å –ø–∞—Ä–æ–ª—å</small>
            </div>

            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </button>
                <a th:href="@{/admin/users}" class="btn btn-secondary">‚ùå –û—Ç–º–µ–Ω–∞</a>
                <button type="reset" class="btn btn-secondary">‚ôªÔ∏è –°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
        </form>

        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="user-info-section">
            <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h3>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">üÜî ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</span>
                    <span class="info-value" th:text="${user?.id} ?: 'N/A'"></span>
                </div>
                <div class="info-item">
                    <span class="info-label">üìÖ –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</span>
                    <span class="info-value">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</span>
                </div>
                <div class="info-item">
                    <span class="info-label">üé≠ –¢–µ–∫—É—â–∞—è —Ä–æ–ª—å:</span>
                    <span class="info-value" th:text="${user?.role} ?: '–ù–µ —É–∫–∞–∑–∞–Ω–∞'"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .user-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .user-id {
        background: var(--gray-light);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--gray);
    }

    .form-hint {
        display: block;
        margin-top: 0.25rem;
        font-size: 0.8rem;
        color: var(--gray);
    }

    .user-info-section {
        margin-top: 2rem;
        padding: 1.5rem;
        background: var(--gray-light);
        border-radius: var(--border-radius);
        border-top: 2px solid var(--gray);
    }

    .user-info-section h3 {
        margin: 0 0 1rem 0;
        color: var(--dark);
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
    }

    .info-item {
        background: white;
        padding: 1rem;
        border-radius: var(--border-radius);
        border-left: 4px solid var(--primary);
    }

    .info-label {
        display: block;
        font-weight: 600;
        color: var(--gray);
        margin-bottom: 0.25rem;
        font-size: 0.9rem;
    }

    .info-value {
        font-size: 1rem;
        color: var(--dark);
        font-weight: 500;
    }

    @media (max-width: 768px) {
        .user-meta {
            flex-direction: column;
            align-items: flex-start;
        }

        .info-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
        const form = document.querySelector('form');
        form.addEventListener('submit', function(e) {
            const username = document.getElementById('username').value;
            const email = document.getElementById('email').value;
            const role = document.getElementById('role').value;

            if (!username || !email || !role) {
                e.preventDefault();
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return false;
            }

            // –ü–æ–∫–∞–∑ loading —Å–æ—Å—Ç–æ—è–Ω–∏—è
            const submitBtn = form.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.innerHTML = '<span class="loading"></span> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
                submitBtn.disabled = true;
            }
        });

        // –°–±—Ä–æ—Å loading —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        form.addEventListener('invalid', function() {
            const submitBtn = form.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.innerHTML = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
                submitBtn.disabled = false;
            }
        }, true);
    });
</script>
</body>
</html>